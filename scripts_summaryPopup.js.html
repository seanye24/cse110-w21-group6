<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scripts/summaryPopup.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scripts/summaryPopup.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Manage Summary Pop-up for page
 */

/**
 * A task object containing a name and pomodoros stats
 * @typedef {Object} Task
 * @property {string} name                - name of the task
 * @property {number} usedPomodoros       - pomodoros used so far
 * @property {number} estimatedPomodoros  - estimated number of pomos needed
 * @property {boolean} selected           - whether task is selected
 * @property {boolean} completed          - whether task is completed
 */

import { subscribe } from '../models';
import {
  createElement,
  getHoursMinutesAndSeconds,
  getTotalSessionTime,
} from '../utils/helpers';

let summaryOverlay;
let summaryPopup;
let taskSummaryList;
let pomodorosStatsElement;
let tasksStatsElement;
let sessionTimeElement;
let closeSummaryButton;

/**
 * Open summary popup
 */
const openPopup = () => {
  summaryOverlay.classList.add('active');
};

/**
 * Close summary popup
 */
const closePopup = () => {
  summaryOverlay.classList.remove('active');
  taskSummaryList.innerHTML = '';
};

/**
 * Create task summary element
 * @param {Task} task - task to summarize
 * @return {HTMLElement} - task summary element
 */
const createTaskSummary = (task) => {
  const { name, usedPomodoros, estimatedPomodoros, status } = task;

  const taskSummary = createElement('div', {
    className: `task-summary-item ${status}`,
  });
  const nameElement = createElement('span', {
    className: 'task-summary-name',
    innerText: name,
  });
  const pomodorosElement = createElement('span', {
    className: 'task-summary-pomodoros',
    innerText: `${usedPomodoros}/${estimatedPomodoros}`,
  });
  taskSummary.append(nameElement, pomodorosElement);

  return taskSummary;
};

/**
 * Create summary of tasks
 * @param {Task[]} allTasks - all tasks
 * @param {Task[]} completedTasks - completed tasks
 */
const createTaskSummaryList = (allTasks, completedTasks) => {
  const completedUnderBudgetTasks = allTasks
    .filter(
      (task) =>
        task.completed &amp;&amp;
        task.usedPomodoros &lt;= task.estimatedPomodoros &amp;&amp;
        completedTasks.some((otherTask) => otherTask.name === task.name),
    )
    .map((t) => ({
      ...t,
      status: 'complete under-budget',
    }));
  const completedOverBudgetTasks = allTasks
    .filter(
      (task) =>
        task.completed &amp;&amp;
        task.usedPomodoros > task.estimatedPomodoros &amp;&amp;
        completedTasks.some((otherTask) => otherTask.name === task.name),
    )
    .map((t) => ({
      ...t,
      status: 'complete over-budget',
    }));
  const inProgressTasks = allTasks
    .filter((t) => !t.completed &amp;&amp; t.usedPomodoros > 0)
    .map((t) => ({ ...t, status: 'in-progress' }));
  const notStartedTasks = allTasks
    .filter((t) => !t.completed &amp;&amp; t.usedPomodoros === 0)
    .map((t) => ({ ...t, status: 'not-started' }));
  const completedDuringPastTasks = allTasks
    .filter(
      (task) =>
        task.completed &amp;&amp;
        !completedTasks.some((otherTask) => otherTask.name === task.name),
    )
    .map((t) => ({ ...t, status: 'complete old' }));
  [
    ...completedUnderBudgetTasks,
    ...completedOverBudgetTasks,
    ...inProgressTasks,
    ...notStartedTasks,
    ...completedDuringPastTasks,
  ].forEach((task) => {
    const taskSummary = createTaskSummary(task);
    taskSummaryList.append(taskSummary);
  });
};

/**
 * @description Access all the shadow root elements and set the summary element
 * @param {HTMLElement} root - the summary element
 */
const initializeElements = (root) => {
  summaryOverlay = root;
  summaryPopup = summaryOverlay.querySelector('#summary-popup');
  taskSummaryList = summaryOverlay.querySelector('.task-summary-list');
  pomodorosStatsElement = summaryOverlay.querySelector('#summary-pomodoros');
  tasksStatsElement = summaryOverlay.querySelector('#summary-tasks');
  sessionTimeElement = summaryOverlay.querySelector('#summary-time');
  closeSummaryButton = summaryOverlay.querySelector('.summary-close-button');
};

/**
 * Initialize popup
 * @param {HTMLElement} root - summary popup element
 * @param {Task[]} tasks - tasks to summarize
 */
const initializePopup = (root, tasks) => {
  initializeElements(root);
  const {
    currentInterval,
    currentTime,
    completedTasks,
    numberOfPomodorosCompleted,
  } = subscribe();

  createTaskSummaryList(tasks, completedTasks);
  const totalSessionTime = getTotalSessionTime(numberOfPomodorosCompleted, {
    intervalName: currentInterval,
    timeRemaining: currentTime,
  });
  console.log('session time: ', totalSessionTime);
  pomodorosStatsElement.innerText = `Number of pomodoros completed: ${numberOfPomodorosCompleted}`;
  tasksStatsElement.innerText = `Number of tasks completed: ${completedTasks.length}`;
  sessionTimeElement.innerText = `Total session time: ${getHoursMinutesAndSeconds(
    totalSessionTime,
  )}`;

  closeSummaryButton.onclick = closePopup;
  closeSummaryButton.onmousedown = (e) => e.preventDefault();
  summaryOverlay.onclick = closePopup;
  summaryPopup.onclick = (e) => e.stopPropagation();
};

export { initializePopup, openPopup, closePopup };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="PomodoroCircles.html">PomodoroCircles</a></li><li><a href="ProgressRing.html">ProgressRing</a></li><li><a href="Settings.html">Settings</a></li><li><a href="TaskItem.html">TaskItem</a></li><li><a href="TaskItemForm.html">TaskItemForm</a></li><li><a href="TaskList.html">TaskList</a></li><li><a href="Timer.html">Timer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addTask">addTask</a></li><li><a href="global.html#addTaskToDom">addTaskToDom</a></li><li><a href="global.html#checkDuplicateTask">checkDuplicateTask</a></li><li><a href="global.html#closePopup">closePopup</a></li><li><a href="global.html#completeTask">completeTask</a></li><li><a href="global.html#createElement">createElement</a></li><li><a href="global.html#createTaskElement">createTaskElement</a></li><li><a href="global.html#createTaskSummary">createTaskSummary</a></li><li><a href="global.html#createTaskSummaryList">createTaskSummaryList</a></li><li><a href="global.html#deleteTask">deleteTask</a></li><li><a href="global.html#deselectAllTasks">deselectAllTasks</a></li><li><a href="global.html#dispatch">dispatch</a></li><li><a href="global.html#endSession">endSession</a></li><li><a href="global.html#getCircleCount">getCircleCount</a></li><li><a href="global.html#getCurrentSelectedTask">getCurrentSelectedTask</a></li><li><a href="global.html#getHoursMinutesAndSeconds">getHoursMinutesAndSeconds</a></li><li><a href="global.html#getLongBreakLength">getLongBreakLength</a></li><li><a href="global.html#getMinutesAndSeconds">getMinutesAndSeconds</a></li><li><a href="global.html#getProgress">getProgress</a></li><li><a href="global.html#getRadius">getRadius</a></li><li><a href="global.html#getShortBreakLength">getShortBreakLength</a></li><li><a href="global.html#getStroke">getStroke</a></li><li><a href="global.html#getTask">getTask</a></li><li><a href="global.html#getTaskItemButtons">getTaskItemButtons</a></li><li><a href="global.html#getTasks">getTasks</a></li><li><a href="global.html#getTime">getTime</a></li><li><a href="global.html#getTimerAudio">getTimerAudio</a></li><li><a href="global.html#getTotalSessionTime">getTotalSessionTime</a></li><li><a href="global.html#handleTaskFormSubmit">handleTaskFormSubmit</a></li><li><a href="global.html#incrementTask">incrementTask</a></li><li><a href="global.html#initializeAnnouncement">initializeAnnouncement</a></li><li><a href="global.html#initializeElements">initializeElements</a></li><li><a href="global.html#initializeIntervalLengths">initializeIntervalLengths</a></li><li><a href="global.html#initializePomodoroCircles">initializePomodoroCircles</a></li><li><a href="global.html#initializePopup">initializePopup</a></li><li><a href="global.html#initializeProgressRing">initializeProgressRing</a></li><li><a href="global.html#initializeTaskList">initializeTaskList</a></li><li><a href="global.html#initializeTimer">initializeTimer</a></li><li><a href="global.html#openPopup">openPopup</a></li><li><a href="global.html#removeTaskFromDom">removeTaskFromDom</a></li><li><a href="global.html#restoreTasks">restoreTasks</a></li><li><a href="global.html#saveSettings">saveSettings</a></li><li><a href="global.html#saveTasks">saveTasks</a></li><li><a href="global.html#selectFirstTask">selectFirstTask</a></li><li><a href="global.html#selectTask">selectTask</a></li><li><a href="global.html#setAnnouncement">setAnnouncement</a></li><li><a href="global.html#setButtonVisibility">setButtonVisibility</a></li><li><a href="global.html#setCircleCount">setCircleCount</a></li><li><a href="global.html#setLongBreakLength">setLongBreakLength</a></li><li><a href="global.html#setProgress">setProgress</a></li><li><a href="global.html#setRadius">setRadius</a></li><li><a href="global.html#setShortBreakLength">setShortBreakLength</a></li><li><a href="global.html#setStroke">setStroke</a></li><li><a href="global.html#setTasklistUsability">setTasklistUsability</a></li><li><a href="global.html#setTimer">setTimer</a></li><li><a href="global.html#setTimerAudio">setTimerAudio</a></li><li><a href="global.html#startInterval">startInterval</a></li><li><a href="global.html#startSession">startSession</a></li><li><a href="global.html#subscribe">subscribe</a></li><li><a href="global.html#tick">tick</a></li><li><a href="global.html#updateTask">updateTask</a></li><li><a href="global.html#validateBoolean">validateBoolean</a></li><li><a href="global.html#validateCircleCount">validateCircleCount</a></li><li><a href="global.html#validateContainerRadius">validateContainerRadius</a></li><li><a href="global.html#validateLength">validateLength</a></li><li><a href="global.html#validateLongBreakLength">validateLongBreakLength</a></li><li><a href="global.html#validateNumber">validateNumber</a></li><li><a href="global.html#validatePomodoro">validatePomodoro</a></li><li><a href="global.html#validateProgress">validateProgress</a></li><li><a href="global.html#validateShortBreakLength">validateShortBreakLength</a></li><li><a href="global.html#validateString">validateString</a></li><li><a href="global.html#validateTask">validateTask</a></li><li><a href="global.html#validateTime">validateTime</a></li><li><a href="global.html#validateTimerAudio">validateTimerAudio</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Wed Mar 17 2021 21:57:16 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
